<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Link Account</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" />
</head>
<body style="background-color: #f4f4f4;">

    <div class="ui middle aligned center aligned grid" style="height: 100vh; margin: 0;">
        <div class="column" style="max-width: 550px; padding: 0 1em;">
            <h1 class="ui header">Link Your Account</h1>
            <p>Welcome! To get all the benefits of integration, please link your account by clicking the button below. This will start the authorization process.</p>
            
            <div class="ui attached segment">
                <p>You will be asked to authorize the application in Discord and then confirm your identity via XAuthConnect.</p>
                <a href="/start" class="ui large primary button">
                    <i class="discord icon"></i>
                    Start Linking Process
                </a>
            </div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const urlParams = new URLSearchParams(window.location.search);
        const status = urlParams.get('status');
        const mainContentDiv = document.querySelector('.column'); // This is the main content area

        if (status) {
            let htmlFileName = '';
            let pageTitle = '';

            switch (status) {
                case 'success':
                    htmlFileName = 'success.html';
                    pageTitle = 'Success';
                    break;
                case 'error':
                    htmlFileName = 'error.html';
                    pageTitle = 'Error';
                    break;
                case 'access_denied':
                    htmlFileName = 'access_denied.html';
                    pageTitle = 'Authorization Cancelled';
                    break;
                default:
                    // If an unknown status, just show default content
                    return;
            }

            try {
                // Fetch the content of the specific status HTML file
                const response = await fetch(htmlFileName);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const htmlContent = await response.text();

                // Extract the body content from the fetched HTML
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlContent, 'text/html');
                const fetchedBodyContent = doc.querySelector('body > div.ui.middle.aligned.center.aligned.grid > div.column').innerHTML;

                // Replace the main content area with the fetched content
                mainContentDiv.innerHTML = fetchedBodyContent;
                document.title = pageTitle;

                // Clean the URL without reloading the page
                window.history.replaceState({}, document.title, window.location.pathname);

            } catch (e) {
                console.error('Failed to load status page content:', e);
                // Fallback to default content or show a generic error
                mainContentDiv.innerHTML = `
                    <i class="warning circle huge orange icon"></i>
                    <h2 class="ui header">An Error Occurred</h2>
                    <p>Failed to load status message. Please try again later.</p>
                    <div style="margin-top: 2em;">
                        <a href="/" class="ui button">
                            Go to Homepage
                        </a>
                    </div>
                `;
                document.title = 'Error';
            }
        }
    });
</script>

</body>
</html>